---
title: "Control Flow"
subtitle: "The building blocks of algorithms"
author: Diogo Melo
date: Sept. 18, 2023
runtime: static
output:
  xaringan::moon_reader:
    css: [default, metropolis, metropolis-fonts, "styles.css"]
    nature:
      highlightLines: true
      chakra: libs/remark-latest.min.js
      beforeInit: "macros.js"
      ratio: "16:9"
      countdown: 60000
---

# The basic elements of an algorithm

- Variables

- Logical comparisons

- Conditionals

- Loops

---

# Example high level algorithm

![:scale 50%](figures/gwas-flowchart.png)

.ref[Turner, S. et al. Quality control procedures for genome-wide association studies. Curr. Protoc. Hum. Genet. Chapter 1, Unit1.19 (2011)]

---

# Logical operators

- Logical operators are used to perform comparisons in R.
- They return logical values: `TRUE` or `FALSE`.
- Essential for control structures and data filtering.

---

# Single Logical Operators

## Single Comparison Operators

- ">" : Greater than
- "<" : Less than
- ">=" : Greater than or equal to
- "<=" : Less than or equal to
- "==" : Equal to
- "!=" : Not equal to

```{r}
x <- 5
y <- 7
x > y
```

---

# Comparing Floating-Point Numbers

.pull-left[
1. **Avoid Exact Equality:**

   - Floating-point arithmetic can lead to tiny differences.
   - Instead of `x == y`, use `abs(x - y) < epsilon`.

2. **Specify Tolerance:**

   - Define a small `epsilon` value to handle small differences.

3. **Use Functions:**

   - `all.equal(x, y)` considers small differences.
   - `identical(x, y)` checks for exact equality.
]
.pull-right[

```{r}
x <- 0.1 + 0.2
y <- 0.3
x == y
epsilon <- 1e-10
abs(x - y) < epsilon
```
]
---

# Double Logical Operators

### Single Operators:

.pull-left[
*  **`&` (AND Operator):**

   The single ampersand `&` operator performs element-wise logical AND between two vectors or scalars. It returns a logical vector of the same length as the inputs, where each element corresponds to the logical AND operation of the corresponding elements in the input vectors.

   ```{r}
   x <- c(TRUE, FALSE, TRUE)
   y <- c(TRUE, TRUE, FALSE)
   x & y 
   ```
]
.pull-right[
* **`|` (OR Operator):**

   The single pipe `|` operator performs element-wise logical OR between two vectors or scalars. It returns a logical vector of the same length as the inputs, where each element corresponds to the logical OR operation of the corresponding elements in the input vectors.

   ```{r}
   x <- c(TRUE, FALSE, TRUE)
   y <- c(FALSE, TRUE, FALSE)
   x | y  
   ```
]
---

# Short-circuit evaluation

### Double Operators:

.pull-left[
* **`&&` (Double AND Operator):**

   The double `&&` operator performs short-circuit evaluation. It evaluates the left-hand side expression first and only evaluates the right-hand side expression if the left-hand side is `TRUE`. If the left-hand side is `FALSE`, the operator immediately returns `FALSE`.

   ```{r}
   x <- 5
   x < 10 && z < 6  # z is undefined
   ```
]
.pull-right[
* **`||` (Double OR Operator):**

   The double `||` operator also performs short-circuit evaluation. It evaluates the left-hand side expression first and only evaluates the right-hand side expression if the left-hand side is `FALSE`. If the left-hand side is `TRUE`, the operator immediately returns `TRUE`.

   ```{r}
   x <- 5
   y <- 7
   x > 2 || y > 10  
   ```
]
---

# Single vs double operators

In summary, single operators (`&` and `|`) always evaluate both sides of the expressions, producing vectors of logical results. Double operators (`&&` and `||`) perform short-circuit evaluation, meaning they only evaluate the right-hand side if necessary, and return a single logical value. Double operators are particularly useful when you want to optimize code execution by avoiding unnecessary evaluations.

---

# if statements 

.pull-left[
- Basic structure:

```r
if (condition) true_action
if (condition) true_action else false_action
```


```{r}
grade <- function(x) {
  if (x > 90) {
    "A"
  } else if (x > 80) {
    "B"
  } else if (x > 70) {
    "C"
  } else {
    "F"
  }
}
grade(74); grade(98)
```
]
.pull-right[

]

---